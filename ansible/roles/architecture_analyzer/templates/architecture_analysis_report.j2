# Verificação de Saúde OpenShift - Relatório de Análise de Arquitetura

## Resumo da Análise

**Timestamp da Análise:** {{ ansible_date_time.iso8601 }}  
**URL do Cluster:** {{ openshift_cluster_url }}  
**Host de Análise:** {{ inventory_hostname }}  

## Status da Análise

| Componente | Status |
|------------|--------|
| Visão Geral do Cluster | {{ '✓ Sucesso' if analysis_status.cluster_overview else '✗ Falhou' }} |
| Análise de Nós | {{ '✓ Sucesso' if analysis_status.node_analysis else '✗ Falhou' }} |
| Análise de Rede | {{ '✓ Sucesso' if analysis_status.network_analysis else '✗ Falhou' }} |
| Análise de Armazenamento | {{ '✓ Sucesso' if analysis_status.storage_analysis else '✗ Falhou' }} |
| Análise de Operadores | {{ '✓ Sucesso' if analysis_status.operator_analysis else '✗ Falhou' }} |
| Distribuição de Recursos | {{ '✓ Sucesso' if analysis_status.resource_distribution else '✗ Falhou' }} |

## Visão Geral do Cluster

{% if analysis_status.cluster_overview %}
- **Versão do Cluster:** {{ architecture_analysis.cluster_overview.cluster_version }}
- **Total de Nós:** {{ architecture_analysis.cluster_overview.total_nodes }}
- **Nós Master:** {{ architecture_analysis.cluster_overview.master_nodes }}
- **Nós Worker:** {{ architecture_analysis.cluster_overview.worker_nodes }}
- **Nós de Infraestrutura:** {{ architecture_analysis.cluster_overview.infrastructure_nodes }}
- **Total de Namespaces:** {{ architecture_analysis.cluster_overview.total_namespaces }}
- **Saúde do Cluster:** {{ architecture_analysis.cluster_overview.cluster_health }}

{% if architecture_analysis.cluster_overview.issues | length > 0 %}
### Problemas do Cluster
{% for issue in architecture_analysis.cluster_overview.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da visão geral do cluster falhou
{% endif %}

## Arquitetura de Nós

{% if analysis_status.node_analysis %}
- **Total de Nós:** {{ architecture_analysis.node_analysis.node_distribution.total_nodes }}
- **Nós Master:** {{ architecture_analysis.node_analysis.node_distribution.master_nodes }}
- **Nós Worker:** {{ architecture_analysis.node_analysis.node_distribution.worker_nodes }}
- **Nós de Infraestrutura:** {{ architecture_analysis.node_analysis.node_distribution.infrastructure_nodes }}

### Utilização de Recursos
- **Total de Cores CPU:** {{ architecture_analysis.node_analysis.resource_utilization.total_cpu_cores }}
- **Total de Memória:** {{ architecture_analysis.node_analysis.resource_utilization.total_memory }}
- **CPU Alocável:** {{ architecture_analysis.node_analysis.resource_utilization.allocatable_cpu }}
- **Memória Alocável:** {{ architecture_analysis.node_analysis.resource_utilization.allocatable_memory }}

{% if architecture_analysis.node_analysis.issues | length > 0 %}
### Problemas dos Nós
{% for issue in architecture_analysis.node_analysis.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da arquitetura de nós falhou
{% endif %}

## Arquitetura de Rede

{% if analysis_status.network_analysis %}
- **Políticas de Rede:** {{ architecture_analysis.network_analysis.network_policies.total_policies }}
- **Namespaces com Políticas:** {{ architecture_analysis.network_analysis.network_policies.namespaces_with_policies }}
- **Total de Rotas:** {{ architecture_analysis.network_analysis.ingress_controllers.total_routes }}
- **Total de Ingresses:** {{ architecture_analysis.network_analysis.ingress_controllers.total_ingresses }}
- **Serviços LoadBalancer:** {{ architecture_analysis.network_analysis.load_balancers.services_with_load_balancer }}
- **Serviços NodePort:** {{ architecture_analysis.network_analysis.load_balancers.services_with_node_port }}

{% if architecture_analysis.network_analysis.issues | length > 0 %}
### Problemas de Rede
{% for issue in architecture_analysis.network_analysis.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da arquitetura de rede falhou
{% endif %}

## Arquitetura de Armazenamento

{% if analysis_status.storage_analysis %}
- **Volumes Persistentes:** {{ architecture_analysis.storage_analysis.persistent_volumes.total_pvs }}
- **PVs Vinculados:** {{ architecture_analysis.storage_analysis.persistent_volumes.bound_pvs }}
- **PVs Disponíveis:** {{ architecture_analysis.storage_analysis.persistent_volumes.available_pvs }}
- **Classes de Armazenamento:** {{ architecture_analysis.storage_analysis.storage_classes.total_storage_classes }}
- **Classe de Armazenamento Padrão:** {{ architecture_analysis.storage_analysis.storage_classes.default_storage_class }}

{% if architecture_analysis.storage_analysis.issues | length > 0 %}
### Problemas de Armazenamento
{% for issue in architecture_analysis.storage_analysis.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da arquitetura de armazenamento falhou
{% endif %}

## Saúde dos Operadores

{% if analysis_status.operator_analysis %}
- **Versões de Serviço do Cluster:** {{ architecture_analysis.operator_analysis.operator_health.total_csvs }}
- **Assinaturas:** {{ architecture_analysis.operator_analysis.operator_health.total_subscriptions }}
- **Planos de Instalação:** {{ architecture_analysis.operator_analysis.operator_health.total_install_plans }}
- **Grupos de Operadores:** {{ architecture_analysis.operator_analysis.operator_health.total_operator_groups }}

{% if architecture_analysis.operator_analysis.operator_issues | length > 0 %}
### Problemas dos Operadores
{% for issue in architecture_analysis.operator_analysis.operator_issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da saúde dos operadores falhou
{% endif %}

## Distribuição de Recursos

{% if analysis_status.resource_distribution %}
- **Total de Namespaces:** {{ architecture_analysis.resource_distribution.namespace_distribution.total_namespaces }}
- **Namespaces do Sistema:** {{ architecture_analysis.resource_distribution.namespace_distribution.system_namespaces }}
- **Namespaces de Usuário:** {{ architecture_analysis.resource_distribution.namespace_distribution.user_namespaces }}
- **Namespaces com Quotas:** {{ architecture_analysis.resource_distribution.namespace_distribution.namespaces_with_quotas }}
- **Namespaces com Limites:** {{ architecture_analysis.resource_distribution.namespace_distribution.namespaces_with_limits }}
- **Total de Pods:** {{ architecture_analysis.resource_distribution.pod_distribution.total_pods }}
- **Pods em Execução:** {{ architecture_analysis.resource_distribution.pod_distribution.running_pods }}
- **Pods Pendentes:** {{ architecture_analysis.resource_distribution.pod_distribution.pending_pods }}
- **Pods Falharam:** {{ architecture_analysis.resource_distribution.pod_distribution.failed_pods }}

{% if architecture_analysis.resource_distribution.issues | length > 0 %}
### Problemas de Distribuição de Recursos
{% for issue in architecture_analysis.resource_distribution.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise da distribuição de recursos falhou
{% endif %}

## Recomendações

### Alta Prioridade
{% if architecture_analysis.cluster_overview.issues | length > 0 %}
- Resolver problemas de saúde do cluster identificados na visão geral
{% endif %}
{% if architecture_analysis.node_analysis.issues | length > 0 %}
- Resolver problemas de saúde dos nós
{% endif %}
{% if architecture_analysis.resource_distribution.pod_distribution.failed_pods > 0 %}
- Investigar e resolver pods que falharam
{% endif %}

### Média Prioridade
{% if architecture_analysis.network_analysis.network_policies.total_policies == 0 %}
- Implementar políticas de rede para melhor segurança
{% endif %}
{% if architecture_analysis.storage_analysis.storage_classes.default_storage_class == "Unknown" %}
- Configurar classe de armazenamento padrão
{% endif %}
{% if architecture_analysis.resource_distribution.namespace_distribution.namespaces_with_quotas < (architecture_analysis.resource_distribution.namespace_distribution.total_namespaces * 0.5) %}
- Implementar quotas de recursos para melhor gerenciamento
{% endif %}

### Baixa Prioridade
{% if architecture_analysis.network_analysis.load_balancers.services_with_load_balancer > 10 %}
- Revisar uso de serviços LoadBalancer para otimização de custos
{% endif %}
{% if architecture_analysis.resource_distribution.pod_distribution.pending_pods > 5 %}
- Monitorar pods pendentes e disponibilidade de recursos
{% endif %}

## Estatísticas da Análise

{% set success_count = 0 %}
{% set total_count = 0 %}
{% for key, value in analysis_status.items() %}
{% set total_count = total_count + 1 %}
{% if value %}
{% set success_count = success_count + 1 %}
{% endif %}
{% endfor %}

**Total de Componentes de Análise:** {{ total_count }}  
**Análises Bem-sucedidas:** {{ success_count }}  
**Análises Falharam:** {{ total_count - success_count }}  
**Taxa de Sucesso:** {{ ((success_count / total_count) * 100) | round(2) }}%  

## Notas

{% if success_count < total_count %}
⚠️ **Aviso:** Algumas tarefas de análise de arquitetura falharam. A análise pode estar incompleta.
{% else %}
✅ **Sucesso:** Todas as tarefas de análise de arquitetura foram concluídas com sucesso.
{% endif %}

Este relatório foi gerado automaticamente pelo playbook de Verificação de Saúde OpenShift do Ansible.
