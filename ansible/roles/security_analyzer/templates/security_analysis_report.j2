# VerificaÃ§Ã£o de SaÃºde OpenShift - RelatÃ³rio de AnÃ¡lise de SeguranÃ§a

{% set rbac_analysis = security_analysis.get('rbac_analysis', {}) if security_analysis is defined else {} %}
{% set pod_security = security_analysis.get('pod_security', {}) if security_analysis is defined else {} %}
{% set network_security = security_analysis.get('network_security', {}) if security_analysis is defined else {} %}
{% set secrets_management = security_analysis.get('secrets_management', {}) if security_analysis is defined else {} %}
{% set compliance = security_analysis.get('compliance', {}) if security_analysis is defined else {} %}

## Resumo da AnÃ¡lise

**Timestamp da AnÃ¡lise:** {{ security_analysis.get('analysis_timestamp', 'Unknown') if security_analysis is defined else 'Unknown' }}  
**URL do Cluster:** {{ security_analysis.get('cluster_url', 'N/A') if security_analysis is defined else 'N/A' }}  
**PontuaÃ§Ã£o Geral de SeguranÃ§a:** {{ security_analysis.get('overall_security_score', 0) if security_analysis is defined else 0 }}/100  

## Status da AnÃ¡lise

| Componente | Status |
|------------|--------|
| AnÃ¡lise RBAC | {{ 'âœ“ Sucesso' if security_analysis_status.get('rbac_analysis', false) else 'âœ— Falhou' }} |
| SeguranÃ§a de Rede | {{ 'âœ“ Sucesso' if security_analysis_status.get('network_security_analysis', false) else 'âœ— Falhou' }} |
| SeguranÃ§a de Pods | {{ 'âœ“ Sucesso' if security_analysis_status.get('pod_security', false) else 'âœ— Falhou' }} |
| Gerenciamento de Segredos | {{ 'âœ“ Sucesso' if security_analysis_status.get('secrets_management_analysis', false) else 'âœ— Falhou' }} |
| AnÃ¡lise de Conformidade | {{ 'âœ“ Sucesso' if security_analysis_status.get('compliance_analysis', false) else 'âœ— Falhou' }} |

## AnÃ¡lise RBAC

{% if security_analysis_status.get('rbac_analysis', false) and rbac_analysis %}
- **Total de Roles do Cluster:** {{ rbac_analysis.get('cluster_roles', {}).get('total_cluster_roles', 0) }}
- **Roles de Administrador do Cluster:** {{ rbac_analysis.get('cluster_roles', {}).get('cluster_admin_roles', 0) }}
- **Roles do Sistema:** {{ rbac_analysis.get('cluster_roles', {}).get('system_roles', 0) }}
- **Roles Personalizados:** {{ rbac_analysis.get('cluster_roles', {}).get('custom_roles', 0) }}
- **Total de VinculaÃ§Ãµes de Roles do Cluster:** {{ rbac_analysis.get('cluster_role_bindings', {}).get('total_bindings', 0) }}
- **VinculaÃ§Ãµes de Administrador do Cluster:** {{ rbac_analysis.get('cluster_role_bindings', {}).get('cluster_admin_bindings', 0) }}
- **Total de Contas de ServiÃ§o:** {{ rbac_analysis.get('service_accounts', {}).get('total_service_accounts', 0) }}

{% if rbac_analysis.get('excessive_permissions', []) | length > 0 %}
### PermissÃµes Excessivas
{% for permission in rbac_analysis.get('excessive_permissions', []) %}
- âš ï¸ {{ permission }}
{% endfor %}
{% endif %}

{% if rbac_analysis.get('privileged_accounts', []) | length > 0 %}
### Contas Privilegiadas
{% for account in rbac_analysis.get('privileged_accounts', []) %}
- âš ï¸ {{ account }}
{% endfor %}
{% endif %}

{% if rbac_analysis.get('issues', []) | length > 0 %}
### Problemas RBAC
{% for issue in rbac_analysis.get('issues', []) %}
- âš ï¸ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
âŒ AnÃ¡lise RBAC falhou
{% endif %}

## AnÃ¡lise de SeguranÃ§a de Pods

{% if security_analysis_status.get('pod_security', false) and pod_security %}
- **Total de Pods:** {{ (pod_security.get('privileged_containers', 0) | int) + (pod_security.get('root_containers', 0) | int) + (pod_security.get('host_network_pods', 0) | int) }}
- **Containers Privilegiados:** {{ pod_security.get('privileged_containers', 0) }}
- **Containers Root:** {{ pod_security.get('root_containers', 0) }}
- **Pods com Rede do Host:** {{ pod_security.get('host_network_pods', 0) }}
- **Pods com PID do Host:** {{ pod_security.get('host_pid_pods', 0) }}
- **Pods com IPC do Host:** {{ pod_security.get('host_ipc_pods', 0) }}
- **RestriÃ§Ãµes de Contexto de SeguranÃ§a:** {{ pod_security.get('security_context_constraints', {}).get('total_sccs', 0) }}
- **PolÃ­ticas de SeguranÃ§a de Pods:** {{ pod_security.get('pod_security_policies', 0) }}

{% if pod_security.get('pod_security_issues', []) | length > 0 %}
### Problemas de SeguranÃ§a de Pods
{% for issue in pod_security.get('pod_security_issues', []) %}
- âš ï¸ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
âŒ AnÃ¡lise de seguranÃ§a de pods falhou
{% endif %}

## RecomendaÃ§Ãµes de SeguranÃ§a

### Alta Prioridade
{% if security_analysis_status.get('rbac_analysis', false) and (rbac_analysis.get('cluster_role_bindings', {}).get('cluster_admin_bindings', 0) | int) > 3 %}
- Reduzir o uso do role cluster-admin ao mÃ­nimo necessÃ¡rio
{% endif %}
{% if security_analysis_status.get('pod_security', false) and (pod_security.get('privileged_containers', 0) | int) > 0 %}
- Remover containers privilegiados ou implementar contextos de seguranÃ§a adequados
{% endif %}
{% if security_analysis_status.get('pod_security', false) and (pod_security.get('root_containers', 0) | int) > 0 %}
- Evitar executar containers como usuÃ¡rio root
{% endif %}

### MÃ©dia Prioridade
{% if security_analysis_status.get('rbac_analysis', false) and rbac_analysis.get('excessive_permissions', []) | length > 0 %}
- Revisar e minimizar permissÃµes excessivas
{% endif %}
{% if security_analysis_status.get('pod_security', false) and (pod_security.get('host_network_pods', 0) | int) > 0 %}
- Evitar usar rede do host para pods quando possÃ­vel
{% endif %}

### Baixa Prioridade
{% if security_analysis_status.get('rbac_analysis', false) and rbac_analysis.get('privileged_accounts', []) | length > 0 %}
- Revisar contas de serviÃ§o com privilÃ©gios elevados
{% endif %}

## Detalhamento da PontuaÃ§Ã£o de SeguranÃ§a

**PontuaÃ§Ã£o Geral:** {{ security_analysis.get('overall_security_score', 0) if security_analysis is defined else 0 }}/100

{% set security_score_int = (security_analysis.get('overall_security_score', 0) | int) if security_analysis is defined else 0 %}
{% if security_score_int >= 90 %}
ğŸŸ¢ **Excelente** - A seguranÃ§a do cluster estÃ¡ bem configurada
{% elif security_score_int >= 70 %}
ğŸŸ¡ **Bom** - Algumas melhorias de seguranÃ§a recomendadas
{% elif security_score_int >= 50 %}
ğŸŸ  **Regular** - VÃ¡rias questÃµes de seguranÃ§a precisam de atenÃ§Ã£o
{% else %}
ğŸ”´ **Ruim** - Melhorias significativas de seguranÃ§a necessÃ¡rias
{% endif %}

## EstatÃ­sticas da AnÃ¡lise

{% set success_count = 0 %}
{% set total_count = 0 %}
{% for key, value in security_analysis_status.items() %}
{% set total_count = total_count + 1 %}
{% if value %}
{% set success_count = success_count + 1 %}
{% endif %}
{% endfor %}

**Total de Componentes de AnÃ¡lise:** {{ total_count }}  
**AnÃ¡lises Bem-sucedidas:** {{ success_count }}  
**AnÃ¡lises Falharam:** {{ total_count - success_count }}  
**Taxa de Sucesso:** {{ ((success_count / total_count) * 100) | round(2) }}%  

## Notas

{% if success_count < total_count %}
âš ï¸ **Aviso:** Algumas tarefas de anÃ¡lise de seguranÃ§a falharam. A anÃ¡lise pode estar incompleta.
{% else %}
âœ… **Sucesso:** Todas as tarefas de anÃ¡lise de seguranÃ§a foram concluÃ­das com sucesso.
{% endif %}

Este relatÃ³rio foi gerado automaticamente pelo playbook de VerificaÃ§Ã£o de SaÃºde OpenShift do Ansible.
