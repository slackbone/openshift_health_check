# Verificação de Saúde OpenShift - Relatório de Análise de Segurança

## Resumo da Análise

**Timestamp da Análise:** {{ security_analysis.analysis_timestamp }}  
**URL do Cluster:** {{ security_analysis.cluster_url }}  
**Pontuação Geral de Segurança:** {{ security_analysis.overall_security_score }}/100  

## Status da Análise

| Componente | Status |
|------------|--------|
| Análise RBAC | {{ '✓ Sucesso' if security_analysis_status.rbac_analysis else '✗ Falhou' }} |
| Segurança de Rede | {{ '✓ Sucesso' if security_analysis_status.network_security else '✗ Falhou' }} |
| Segurança de Pods | {{ '✓ Sucesso' if security_analysis_status.pod_security else '✗ Falhou' }} |
| Gerenciamento de Segredos | {{ '✓ Sucesso' if security_analysis_status.secrets_management else '✗ Falhou' }} |
| Análise de Conformidade | {{ '✓ Sucesso' if security_analysis_status.compliance_analysis else '✗ Falhou' }} |

## Análise RBAC

{% if security_analysis_status.rbac_analysis %}
- **Total de Roles do Cluster:** {{ security_analysis.rbac_analysis.cluster_roles.total_cluster_roles }}
- **Roles de Administrador do Cluster:** {{ security_analysis.rbac_analysis.cluster_roles.cluster_admin_roles }}
- **Roles do Sistema:** {{ security_analysis.rbac_analysis.cluster_roles.system_roles }}
- **Roles Personalizados:** {{ security_analysis.rbac_analysis.cluster_roles.custom_roles }}
- **Total de Vinculações de Roles do Cluster:** {{ security_analysis.rbac_analysis.cluster_role_bindings.total_bindings }}
- **Vinculações de Administrador do Cluster:** {{ security_analysis.rbac_analysis.cluster_role_bindings.cluster_admin_bindings }}
- **Total de Contas de Serviço:** {{ security_analysis.rbac_analysis.service_accounts.total_service_accounts }}

{% if security_analysis.rbac_analysis.excessive_permissions | length > 0 %}
### Permissões Excessivas
{% for permission in security_analysis.rbac_analysis.excessive_permissions %}
- ⚠️ {{ permission }}
{% endfor %}
{% endif %}

{% if security_analysis.rbac_analysis.privileged_accounts | length > 0 %}
### Contas Privilegiadas
{% for account in security_analysis.rbac_analysis.privileged_accounts %}
- ⚠️ {{ account }}
{% endfor %}
{% endif %}

{% if security_analysis.rbac_analysis.issues | length > 0 %}
### Problemas RBAC
{% for issue in security_analysis.rbac_analysis.issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise RBAC falhou
{% endif %}

## Análise de Segurança de Pods

{% if security_analysis_status.pod_security %}
- **Total de Pods:** {{ security_analysis.pod_security.privileged_containers + security_analysis.pod_security.root_containers + security_analysis.pod_security.host_network_pods }}
- **Containers Privilegiados:** {{ security_analysis.pod_security.privileged_containers }}
- **Containers Root:** {{ security_analysis.pod_security.root_containers }}
- **Pods com Rede do Host:** {{ security_analysis.pod_security.host_network_pods }}
- **Pods com PID do Host:** {{ security_analysis.pod_security.host_pid_pods }}
- **Pods com IPC do Host:** {{ security_analysis.pod_security.host_ipc_pods }}
- **Restrições de Contexto de Segurança:** {{ security_analysis.pod_security.security_context_constraints.total_sccs }}
- **Políticas de Segurança de Pods:** {{ security_analysis.pod_security.pod_security_policies }}

{% if security_analysis.pod_security.pod_security_issues | length > 0 %}
### Problemas de Segurança de Pods
{% for issue in security_analysis.pod_security.pod_security_issues %}
- ⚠️ {{ issue }}
{% endfor %}
{% endif %}
{% else %}
❌ Análise de segurança de pods falhou
{% endif %}

## Recomendações de Segurança

### Alta Prioridade
{% if security_analysis_status.rbac_analysis and security_analysis.rbac_analysis.cluster_role_bindings.cluster_admin_bindings > 3 %}
- Reduzir o uso do role cluster-admin ao mínimo necessário
{% endif %}
{% if security_analysis_status.pod_security and security_analysis.pod_security.privileged_containers > 0 %}
- Remover containers privilegiados ou implementar contextos de segurança adequados
{% endif %}
{% if security_analysis_status.pod_security and security_analysis.pod_security.root_containers > 0 %}
- Evitar executar containers como usuário root
{% endif %}

### Média Prioridade
{% if security_analysis_status.rbac_analysis and security_analysis.rbac_analysis.excessive_permissions | length > 0 %}
- Revisar e minimizar permissões excessivas
{% endif %}
{% if security_analysis_status.pod_security and security_analysis.pod_security.host_network_pods > 0 %}
- Evitar usar rede do host para pods quando possível
{% endif %}

### Baixa Prioridade
{% if security_analysis_status.rbac_analysis and security_analysis.rbac_analysis.privileged_accounts | length > 0 %}
- Revisar contas de serviço com privilégios elevados
{% endif %}

## Detalhamento da Pontuação de Segurança

**Pontuação Geral:** {{ security_analysis.overall_security_score }}/100

{% if security_analysis.overall_security_score >= 90 %}
🟢 **Excelente** - A segurança do cluster está bem configurada
{% elif security_analysis.overall_security_score >= 70 %}
🟡 **Bom** - Algumas melhorias de segurança recomendadas
{% elif security_analysis.overall_security_score >= 50 %}
🟠 **Regular** - Várias questões de segurança precisam de atenção
{% else %}
🔴 **Ruim** - Melhorias significativas de segurança necessárias
{% endif %}

## Estatísticas da Análise

{% set success_count = 0 %}
{% set total_count = 0 %}
{% for key, value in security_analysis_status.items() %}
{% set total_count = total_count + 1 %}
{% if value %}
{% set success_count = success_count + 1 %}
{% endif %}
{% endfor %}

**Total de Componentes de Análise:** {{ total_count }}  
**Análises Bem-sucedidas:** {{ success_count }}  
**Análises Falharam:** {{ total_count - success_count }}  
**Taxa de Sucesso:** {{ ((success_count / total_count) * 100) | round(2) }}%  

## Notas

{% if success_count < total_count %}
⚠️ **Aviso:** Algumas tarefas de análise de segurança falharam. A análise pode estar incompleta.
{% else %}
✅ **Sucesso:** Todas as tarefas de análise de segurança foram concluídas com sucesso.
{% endif %}

Este relatório foi gerado automaticamente pelo playbook de Verificação de Saúde OpenShift do Ansible.
